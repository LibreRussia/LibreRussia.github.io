<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>Скрипт для замены служебных символов в XML - Блог про LibreOffice</title>	
	<meta name="author" content="Dmitry Mazhartsev">
	

	<meta name="description" content="Оглавление Описание Системные требования Авторские права Обратная связь Порядок работы Выводимая информация Рекомендации Проверка изменений в файлах Программное обеспечение Приложение Описание xml_healer.py (англ. healer — целитель) — скрипт для массового исправления невалидных XML файлов. Скрипт выполняет следующие замены: Символ & заменяется на &amp;; Символ < заменяется на '&lt;; Символ > заменяется на &gt; Символы ...">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
		

</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	    </div>
		<a href="" class="title">Блог про LibreOffice</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
			
		<h1>Скрипт для замены служебных символов в XML</h1>
		
<div class="metadata">
  <time datetime="2015-06-05T00:20:00+02:00" pubdate>Пт. 05 Июнь 2015</time>
    <address class="vcard author">
      by <a class="url fn" href="/author/dmitry-mazhartsev.html">Dmitry Mazhartsev</a>
    </address>
  in <a href="/category/python.html">Python</a>
<p class="tags">tagged <a href="/tag/skripty.html">Скрипты</a>, <a href="/tag/python.html">Python</a>, <a href="/tag/xml.html">XML</a>, <a href="/tag/regexp.html">RegExp</a></p></div>		
		<div class="contents topic" id="id1">
<p class="topic-title first">Оглавление</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id15">Описание</a><ul>
<li><a class="reference internal" href="#id3" id="id16">Системные требования</a></li>
<li><a class="reference internal" href="#id4" id="id17">Авторские права</a></li>
<li><a class="reference internal" href="#id5" id="id18">Обратная связь</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id19">Порядок работы</a><ul>
<li><a class="reference internal" href="#id7" id="id20">Выводимая информация</a></li>
<li><a class="reference internal" href="#id8" id="id21">Рекомендации</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id22">Проверка изменений в файлах</a></li>
<li><a class="reference internal" href="#id11" id="id23">Программное обеспечение</a></li>
<li><a class="reference internal" href="#id14" id="id24">Приложение</a></li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id15">Описание</a></h2>
<p><tt class="docutils literal">xml_healer.py</tt> (<em>англ.</em> healer — целитель) — скрипт для массового исправления невалидных XML файлов.</p>
<p>Скрипт выполняет следующие замены:</p>
<ul class="simple">
<li>Символ <tt class="docutils literal">&amp;</tt> заменяется на <tt class="docutils literal">&amp;amp;</tt>;</li>
<li>Символ <tt class="docutils literal">&lt;</tt> заменяется на <tt class="docutils literal">'&amp;lt;</tt>;</li>
<li>Символ <tt class="docutils literal">&gt;</tt> заменяется на <tt class="docutils literal">&amp;gt;</tt></li>
<li>Символы <tt class="docutils literal">«»</tt> заменяются на <tt class="docutils literal">&amp;quot;</tt></li>
</ul>
<p>Также скрипт удаляет все, что идет после закрывающего родительского тега <tt class="docutils literal">&lt;\Файл&gt;</tt>.</p>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id16">Системные требования</a></h3>
<p>Для работы скрипта необходимо установить интерпритатор языка программирования Python (<a class="reference external" href="https://www.python.org/downloads/">https://www.python.org/downloads/</a>) версии 3 или выше.</p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id17">Авторские права</a></h3>
<p>Скрипт xml_healer.py распространяется на условиях лицензии <a class="reference external" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ru">«Attribution-ShareAlike» («Атрибуция — На тех же условиях») 4.0 Всемирная</a>.</p>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id18">Обратная связь</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Автор:</th><td class="field-body">Дмитрий Мажарцев</td>
</tr>
<tr class="field"><th class="field-name">Контакты:</th><td class="field-body"><a class="reference external" href="mailto:uksvlg&#64;yandex.ru">uksvlg&#64;yandex.ru</a></td>
</tr>
<tr class="field"><th class="field-name">Адрес:</th><td class="field-body">Волгоград</td>
</tr>
<tr class="field"><th class="field-name">Дата:</th><td class="field-body">04 июня 2015 года</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id19">Порядок работы</a></h2>
<ol class="arabic simple">
<li>Поместить скрипт <tt class="docutils literal">xml_healer.py</tt> в папку с XML файлами отчетов;</li>
<li>Запустить скрипт двойным нажатием и дождаться завершения его работы;</li>
<li>Ещё раз прогнать исправленный XML файл через <a class="reference external" href="http://www.nalog.ru/rn77/program/all/tester/">Tester</a>.</li>
</ol>
<p>После завершения обработки файлов в командной строке будет выведена информация о результате обработки и сообщение «<em>Нажмите Enter</em>». Обработанные файлы будут находиться в папке <tt class="docutils literal">out</tt>. Оригинальные файлы останутся нетронутыми в текущей директории.</p>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id20">Выводимая информация</a></h3>
<p>В ходе выполнения скрипта выводится несколько типов сообщений:</p>
<div class="highlight"><pre>Имя файла: NO_NDS.9_0000_0000_00000000000000000000_20150427_80c4e37b-a160-4b2f-827c-69226f792dfd.xml
Исцелен!
</pre></div>
<p>Сообщение <tt class="docutils literal">Исцелен!</tt> означает, что файл успешно обработан и его исправленная копия находится в папке <tt class="docutils literal">out</tt>.</p>
<div class="highlight"><pre>Имя файла: ФАЙЛ.odt
Не является XML-файлом
</pre></div>
<p>Сообщение <tt class="docutils literal">Не является <span class="pre">XML-файлом</span></tt> означает, что файл не является файлом отчета. <tt class="docutils literal">xml_healer.py</tt> сканирует все файлы в папке, в которой находится и обрабатывает только те файлы, в конце которых стоит расширение <tt class="docutils literal">.xml</tt>.</p>
<div class="highlight"><pre>Имя файла: file.xml
Файл имеет кодировку отличную от windows-1251
</pre></div>
<p>Сообщение появляется, если XML файл имеет кодировку отличную от <tt class="docutils literal"><span class="pre">windows-1251</span></tt>. Возможно, данный XML файл не является файлом отчета, так как файлы отчетов должны иметь кодировку <tt class="docutils literal"><span class="pre">windows-1251</span></tt>.</p>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id21">Рекомендации</a></h3>
<p>После работы скрипта рекомендуется прогнать XML файлы через <a class="reference external" href="http://www.nalog.ru/rn77/program/all/tester/">Tester</a>. При проверке невалидного XML файла Tester, натыкаясь на первый же некорректный символ, прекращает проверку. <tt class="docutils literal">xml_healer.py</tt> исправляет все некорректные символы и Tester может осуществить полную проверку файла, в ходе которой могут обнаружиться ошибки уже не в структуре файла, а в самом содержимом.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id22">Проверка изменений в файлах</a></h2>
<p>Чтобы проверить и сравнить изменения в XML файлах, необходимо воспользоваться программой <a class="reference external" href="http://winmerge.org/about/?lang=ru">WinMerge</a>.</p>
<div class="figure align-center">
<img alt="WinMerge — программа для сравнения текстовых файлов" src="img/img-xml-healer/xml_healer_screen-007.jpg" style="width: 500px;" />
<p class="caption">Слева —  исходный файл. Справа — файл после обработки скриптом <tt class="docutils literal">xml_healer.py</tt></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id23">Программное обеспечение</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mazhartsev/xml_healer.py/archive/master.zip">xml_healer.py</a></li>
<li><a class="reference external" href="https://www.python.org/downloads/">Python 3</a></li>
<li><a class="reference external" href="http://www.nalog.ru/rn77/program/all/tester/">Tester</a></li>
<li><a class="reference external" href="http://winmerge.org/about/?lang=ru">WinMerge</a></li>
</ul>
</div>
<div class="section" id="id14">
<h2><a class="toc-backref" href="#id24">Приложение</a></h2>
<p>Процесс работы скрипта <tt class="docutils literal">xml_healer.py</tt> со скриншотами:</p>
<div class="figure align-center">
<img alt="Шаг 0 — Прогон файла через Tester" src="img/img-xml-healer/xml_healer_screen-004.jpg" style="width: 400px;" />
<p class="caption">Шаг 0 — Прогон файла через Tester</p>
</div>
<div class="figure align-center">
<img alt="Шаг 1 — Поместить скрипт с файлами для обработки" src="img/img-xml-healer/xml_healer_screen-001.png" style="width: 400px;" />
<p class="caption">Шаг 1 — Поместить скрипт с файлами для обработки и дойным нажатием запустить скрипт.</p>
</div>
<div class="figure align-center">
<img alt="Шаг 2 — Во время работы скрипта откроется окно командной строки, в котором будет выведен результат обработки файлов." src="img/img-xml-healer/xml_healer_screen-002.png" style="width: 400px;" />
<p class="caption">Шаг 2 — Во время работы скрипта откроется окно командной строки, в котором будет выведен результат обработки файлов.</p>
</div>
<div class="figure align-center">
<img alt="Шаг 3 — Обработанные файлы будут находиться в папке out" src="img/img-xml-healer/xml_healer_screen-003.png" style="width: 400px;" />
<p class="caption">Шаг 3 — Обработанные файлы будут находиться в папке <tt class="docutils literal">out</tt>.</p>
</div>
<div class="figure align-center">
<img alt="Шаг 4 — Повторный прогон исправленного файла через Tester" src="img/img-xml-healer/xml_healer_screen-005.jpg" style="width: 200px;" />
</div>
</div>
	

	</article>

    <p>
	<a href="https://twitter.com/share" class="twitter-share-button" data-via="" data-lang="en" data-size="large" data-related="">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	</p>


		  </div>	
		  
		  <div class="sidebar">

	        <nav>
	          <h2>Категории</h2>
	          <ul>
	              <li ><a href="/category/libreoffice.html">LibreOffice</a></li>
	              <li class="active"><a href="/category/python.html">Python</a></li>
	              <li ><a href="/category/razmetka.html">Разметка</a></li>
	          </ul>
	        </nav>



		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  © 2013 Dmitry Mazhartsev - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
    	</p>

	  </footer>	

	</div>
	

</body>
</html>